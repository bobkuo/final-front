import{E as le,al as ue,am as ce,g as ne,an as se,c as i,r as M,w as de,ao as ee,ap as me,V as ve,h as Q,ab as oe,L as X,aq as ge,ar as fe,as as ye,at as be,au as he,U as Se,Q as xe,av as ke,X as J,a8 as _e,a9 as ie,t as Ce,z as E,m as _,B as y,f as v,aw as Y,l as H,F as G,A as W,q as k,u as q,ax as te,p as Ve,ad as R,ay as Ae,az as Pe,aa as we,aA as Le,R as $e}from"./index-ZlmJWsMw.js";import{Q as Be}from"./QChip-7DxszJLz.js";import{Q as Ie,a as qe,b as Qe}from"./QList-B6qOs73r.js";import{Q as Me}from"./QMenu-Dx5LITJC.js";import{b as re}from"./format-BvkBI9bc.js";import{Q as Fe}from"./QPage-kjWgpU47.js";import{C as je}from"./ClosePopup-DrwsR65z.js";import{p as De}from"./product-CyIB1ZbY.js";import{Q as Ne,a as Ee}from"./QCarousel-I94Va48B.js";import{Q as He}from"./QImg-BneDaiVU.js";import{Q as ae}from"./QBadge-CZmtfBrZ.js";import"./selection-DJuinEMp.js";import"./touch-BjYP5sR0.js";import"./use-fullscreen-CXz7WVws.js";function K(e,w){return[!0,!1].includes(e)?e:w}const Oe=le({name:"QPagination",props:{...ce,modelValue:{type:Number,required:!0},min:{type:[Number,String],default:1},max:{type:[Number,String],required:!0},maxPages:{type:[Number,String],default:0,validator:e=>(typeof e=="string"?parseInt(e,10):e)>=0},inputStyle:[Array,String,Object],inputClass:[Array,String,Object],size:String,disable:Boolean,input:Boolean,iconPrev:String,iconNext:String,iconFirst:String,iconLast:String,toFn:Function,boundaryLinks:{type:Boolean,default:null},boundaryNumbers:{type:Boolean,default:null},directionLinks:{type:Boolean,default:null},ellipses:{type:Boolean,default:null},ripple:{type:[Boolean,Object],default:null},round:Boolean,rounded:Boolean,flat:Boolean,outline:Boolean,unelevated:Boolean,push:Boolean,glossy:Boolean,color:{type:String,default:"primary"},textColor:String,activeDesign:{type:String,default:"",values:e=>e===""||ue.includes(e)},activeColor:String,activeTextColor:String,gutter:String,padding:{type:String,default:"3px 2px"}},emits:["update:modelValue"],setup(e,{emit:w}){const{proxy:L}=ne(),{$q:d}=L,S=se(e,d),m=i(()=>parseInt(e.min,10)),u=i(()=>parseInt(e.max,10)),s=i(()=>parseInt(e.maxPages,10)),b=i(()=>c.value+" / "+u.value),h=i(()=>K(e.boundaryLinks,e.input)),g=i(()=>K(e.boundaryNumbers,!e.input)),O=i(()=>K(e.directionLinks,e.input)),F=i(()=>K(e.ellipses,!e.input)),j=M(null),c=i({get:()=>e.modelValue,set:l=>{if(l=parseInt(l,10),e.disable||isNaN(l))return;const o=re(l,m.value,u.value);e.modelValue!==o&&w("update:modelValue",o)}});de(()=>`${m.value}|${u.value}`,()=>{c.value=e.modelValue});const f=i(()=>"q-pagination row no-wrap items-center"+(e.disable===!0?" disabled":"")),r=i(()=>e.gutter in ee?`${ee[e.gutter]}px`:e.gutter||null),V=i(()=>r.value!==null?`--q-pagination-gutter-parent:-${r.value};--q-pagination-gutter-child:${r.value}`:null),A=i(()=>{const l=[e.iconFirst||d.iconSet.pagination.first,e.iconPrev||d.iconSet.pagination.prev,e.iconNext||d.iconSet.pagination.next,e.iconLast||d.iconSet.pagination.last];return d.lang.rtl===!0?l.reverse():l}),n=i(()=>({"aria-disabled":e.disable===!0?"true":"false",role:"navigation"})),a=i(()=>me(e,"flat")),x=i(()=>({[a.value]:!0,round:e.round,rounded:e.rounded,padding:e.padding,color:e.color,textColor:e.textColor,size:e.size,ripple:e.ripple!==null?e.ripple:!0})),B=i(()=>{const l={[a.value]:!1};return e.activeDesign!==""&&(l[e.activeDesign]=!0),l}),I=i(()=>({...B.value,color:e.activeColor||e.color,textColor:e.activeTextColor||e.textColor})),t=i(()=>{let l=Math.max(s.value,1+(F.value?2:0)+(g.value?2:0));const o={pgFrom:m.value,pgTo:u.value,ellipsesStart:!1,ellipsesEnd:!1,boundaryStart:!1,boundaryEnd:!1,marginalStyle:{minWidth:`${Math.max(2,String(u.value).length)}em`}};return s.value&&l<u.value-m.value+1&&(l=1+Math.floor(l/2)*2,o.pgFrom=Math.max(m.value,Math.min(u.value-l+1,e.modelValue-Math.floor(l/2))),o.pgTo=Math.min(u.value,o.pgFrom+l-1),g.value&&(o.boundaryStart=!0,o.pgFrom++),F.value&&o.pgFrom>m.value+(g.value?1:0)&&(o.ellipsesStart=!0,o.pgFrom++),g.value&&(o.boundaryEnd=!0,o.pgTo--),F.value&&o.pgTo<u.value-(g.value?1:0)&&(o.ellipsesEnd=!0,o.pgTo--)),o});function P(l){c.value=l}function D(l){c.value=c.value+l}const T=i(()=>{function l(){c.value=j.value,j.value=null}return{"onUpdate:modelValue":o=>{j.value=o},onKeyup:o=>{ve(o,13)===!0&&l()},onBlur:l}});function C(l,o,z){const N={"aria-label":o,"aria-current":"false",...x.value,...l};return z===!0&&Object.assign(N,{"aria-current":"true",...I.value}),o!==void 0&&(e.toFn!==void 0?N.to=e.toFn(o):N.onClick=()=>{P(o)}),Q(X,N)}return Object.assign(L,{set:P,setByOffset:D}),()=>{const l=[],o=[];let z;if(h.value===!0&&(l.push(C({key:"bls",disable:e.disable||e.modelValue<=m.value,icon:A.value[0],"aria-label":d.lang.pagination.first},m.value)),o.unshift(C({key:"ble",disable:e.disable||e.modelValue>=u.value,icon:A.value[3],"aria-label":d.lang.pagination.last},u.value))),O.value===!0&&(l.push(C({key:"bdp",disable:e.disable||e.modelValue<=m.value,icon:A.value[1],"aria-label":d.lang.pagination.prev},e.modelValue-1)),o.unshift(C({key:"bdn",disable:e.disable||e.modelValue>=u.value,icon:A.value[2],"aria-label":d.lang.pagination.next},e.modelValue+1))),e.input!==!0){z=[];const{pgFrom:N,pgTo:p,marginalStyle:U}=t.value;if(t.value.boundaryStart===!0){const $=m.value===e.modelValue;l.push(C({key:"bns",style:U,disable:e.disable,label:m.value},m.value,$))}if(t.value.boundaryEnd===!0){const $=u.value===e.modelValue;o.unshift(C({key:"bne",style:U,disable:e.disable,label:u.value},u.value,$))}t.value.ellipsesStart===!0&&l.push(C({key:"bes",style:U,disable:e.disable,label:"…",ripple:!1},N-1)),t.value.ellipsesEnd===!0&&o.unshift(C({key:"bee",style:U,disable:e.disable,label:"…",ripple:!1},p+1));for(let $=N;$<=p;$++)z.push(C({key:`bpg${$}`,style:U,disable:e.disable,label:$},$,$===e.modelValue))}return Q("div",{class:f.value,...n.value},[Q("div",{class:"q-pagination__content row no-wrap items-center",style:V.value},[...l,e.input===!0?Q(oe,{class:"inline",style:{width:`${b.value.length/1.5}em`},type:"number",dense:!0,value:j.value,disable:e.disable,dark:S.value,borderless:!0,inputClass:e.inputClass,inputStyle:e.inputStyle,placeholder:b.value,min:m.value,max:u.value,...T.value}):Q("div",{class:"q-pagination__middle row justify-center"},z),...o])])}}}),Te=le({name:"QRating",props:{...fe,...ge,modelValue:{type:Number,required:!0},max:{type:[String,Number],default:5},icon:[String,Array],iconHalf:[String,Array],iconSelected:[String,Array],iconAriaLabel:[String,Array],color:[String,Array],colorHalf:[String,Array],colorSelected:[String,Array],noReset:Boolean,noDimming:Boolean,readonly:Boolean,disable:Boolean},emits:["update:modelValue"],setup(e,{slots:w,emit:L}){const{proxy:{$q:d}}=ne(),S=ye(e),m=be(e),u=ke(m),s=M(0);let b={};const h=i(()=>e.readonly!==!0&&e.disable!==!0),g=i(()=>`q-rating row inline items-center q-rating--${h.value===!0?"":"non-"}editable`+(e.noDimming===!0?" q-rating--no-dimming":"")+(e.disable===!0?" disabled":"")+(e.color!==void 0&&Array.isArray(e.color)===!1?` text-${e.color}`:"")),O=i(()=>{const n=Array.isArray(e.icon)===!0?e.icon.length:0,a=Array.isArray(e.iconSelected)===!0?e.iconSelected.length:0,x=Array.isArray(e.iconHalf)===!0?e.iconHalf.length:0,B=Array.isArray(e.color)===!0?e.color.length:0,I=Array.isArray(e.colorSelected)===!0?e.colorSelected.length:0,t=Array.isArray(e.colorHalf)===!0?e.colorHalf.length:0;return{iconLen:n,icon:n>0?e.icon[n-1]:e.icon,selIconLen:a,selIcon:a>0?e.iconSelected[a-1]:e.iconSelected,halfIconLen:x,halfIcon:x>0?e.iconHalf[a-1]:e.iconHalf,colorLen:B,color:B>0?e.color[B-1]:e.color,selColorLen:I,selColor:I>0?e.colorSelected[I-1]:e.colorSelected,halfColorLen:t,halfColor:t>0?e.colorHalf[t-1]:e.colorHalf}}),F=i(()=>{if(typeof e.iconAriaLabel=="string"){const n=e.iconAriaLabel.length!==0?`${e.iconAriaLabel} `:"";return a=>`${n}${a}`}if(Array.isArray(e.iconAriaLabel)===!0){const n=e.iconAriaLabel.length;if(n>0)return a=>e.iconAriaLabel[Math.min(a,n)-1]}return(n,a)=>`${a} ${n}`}),j=i(()=>{const n=[],a=O.value,x=Math.ceil(e.modelValue),B=h.value===!0?0:null,I=e.iconHalf===void 0||x===e.modelValue?-1:x;for(let t=1;t<=e.max;t++){const P=s.value===0&&e.modelValue>=t||s.value>0&&s.value>=t,D=I===t&&s.value<t,T=s.value>0&&(D===!0?x:e.modelValue)>=t&&s.value<t,C=D===!0?t<=a.halfColorLen?e.colorHalf[t-1]:a.halfColor:a.selColor!==void 0&&P===!0?t<=a.selColorLen?e.colorSelected[t-1]:a.selColor:t<=a.colorLen?e.color[t-1]:a.color,l=(D===!0?t<=a.halfIconLen?e.iconHalf[t-1]:a.halfIcon:a.selIcon!==void 0&&(P===!0||T===!0)?t<=a.selIconLen?e.iconSelected[t-1]:a.selIcon:t<=a.iconLen?e.icon[t-1]:a.icon)||d.iconSet.rating.icon;n.push({name:(D===!0?t<=a.halfIconLen?e.iconHalf[t-1]:a.halfIcon:a.selIcon!==void 0&&(P===!0||T===!0)?t<=a.selIconLen?e.iconSelected[t-1]:a.selIcon:t<=a.iconLen?e.icon[t-1]:a.icon)||d.iconSet.rating.icon,attrs:{tabindex:B,role:"radio","aria-checked":e.modelValue===t?"true":"false","aria-label":F.value(t,l)},iconClass:"q-rating__icon"+(P===!0||D===!0?" q-rating__icon--active":"")+(T===!0?" q-rating__icon--exselected":"")+(s.value===t?" q-rating__icon--hovered":"")+(C!==void 0?` text-${C}`:"")})}return n}),c=i(()=>{const n={role:"radiogroup"};return e.disable===!0&&(n["aria-disabled"]="true"),e.readonly===!0&&(n["aria-readonly"]="true"),n});function f(n){if(h.value===!0){const a=re(parseInt(n,10),1,parseInt(e.max,10)),x=e.noReset!==!0&&e.modelValue===a?0:a;x!==e.modelValue&&L("update:modelValue",x),s.value=0}}function r(n){h.value===!0&&(s.value=n)}function V(n,a){switch(n.keyCode){case 13:case 32:return f(a),J(n);case 37:case 40:return b[`rt${a-1}`]&&b[`rt${a-1}`].focus(),J(n);case 39:case 38:return b[`rt${a+1}`]&&b[`rt${a+1}`].focus(),J(n)}}function A(){s.value=0}return he(()=>{b={}}),()=>{const n=[];return j.value.forEach(({iconClass:a,name:x,attrs:B},I)=>{const t=I+1;n.push(Q("div",{key:t,ref:P=>{b[`rt${t}`]=P},class:"q-rating__icon-container flex flex-center",...B,onClick(){f(t)},onMouseover(){r(t)},onMouseout:A,onFocus(){r(t)},onBlur:A,onKeyup(P){V(P,t)}},Se(w[`tip-${t}`],[Q(xe,{class:a,name:x})])))}),e.name!==void 0&&e.disable!==!0&&u(n,"push"),Q("div",{class:g.value,style:S.value,...c.value},n)}}}),ze={class:"absolute-bottom text-subtitle4 text-center"},Ue={key:2,class:"text-caption text-grey text-center"},Re={class:"row items-center"},Ke={class:"col text-h6 ellipsis"},Ge={class:"text-subtitle1"},We={class:"text-caption text-grey",style:{height:"60px",overflow:"auto","white-space":"pre-line"}},Xe={__name:"ProductCard",props:{product:Object},setup(e){const w=M(0),L=M(3),d=_e(),S=ie(),m=async()=>{if(!d.isLoggedIn){S.dialog({title:"需要登入",message:"請先登入帳號才能加入購物車"});return}try{const{data:u}=await we.cart({product:e.product._id,quantity:1});d.cartTotal=u.result,S.notify({type:"positive",message:"已加入購物車"})}catch(u){console.error("Error fetching products:",u),S.notify({type:"negative",message:"無法加入購物車，請稍後再試"})}};return(u,s)=>{const b=Ce("router-link");return _(),E(Pe,{flat:"",bordered:""},{default:y(()=>[v(Y,null,{default:y(()=>[e.product.images.length>1?(_(),E(Ne,{key:0,autoplay:!1,arrows:!0,infinite:!0,height:"300px",swipeable:"",class:"rounded-borders",modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=h=>w.value=h),"control-type":"outline","control-color":"purple"},{default:y(()=>[(_(!0),H(G,null,W(e.product.images,(h,g)=>(_(),E(Ee,{key:g,name:g,"img-src":h,style:{"background-size":"cover","background-position":"center"}},{default:y(()=>[k("div",ze,q(e.product.name)+" - "+q(g+1),1)]),_:2},1032,["name","img-src"]))),128))]),_:1},8,["modelValue"])):e.product.images.length===1?(_(),E(He,{key:1,src:e.product.images[0],height:"300px",fit:"contain"},null,8,["src"])):(_(),H("div",Ue,"無商品圖片"))]),_:1}),v(te),v(Y,null,{default:y(()=>[k("div",Re,[k("div",Ke,[v(b,{to:"/product/"+e.product._id},{default:y(()=>[R(q(e.product.name),1)]),_:1},8,["to"])]),e.product.category?(_(),E(ae,{key:0,class:"q-ml-sm",color:"primary",label:e.product.category,outline:""},null,8,["label"])):Ve("",!0),v(ae,{color:"orange",class:"q-ml-sm"},{default:y(()=>[R(" 已售 "+q(e.product.sold||0),1)]),_:1})]),v(Te,{modelValue:L.value,"onUpdate:modelValue":s[1]||(s[1]=h=>L.value=h),max:5,readonly:"",size:"32px",color:"yellow",icon:"star_border","icon-selected":"star","icon-half":"star_half","no-dimming":""},null,8,["modelValue"])]),_:1}),v(Y,{class:"q-pt-none"},{default:y(()=>[k("div",Ge,"$"+q(e.product.price),1),k("div",We,q(e.product.description),1)]),_:1}),v(te),v(Ae,{class:"justify-end"},{default:y(()=>[v(X,{outline:"",icon:"favorite",color:"red"}),v(X,{outline:"",icon:"add_shopping_cart",color:"primary",onClick:m},{default:y(()=>s[2]||(s[2]=[R(" 加入購物車 ",-1)])),_:1,__:[2]})]),_:1})]),_:1})}}},Je={class:"row full-width q-mb-lg"},Ye={class:"col-12"},Ze={class:"col-12"},pe={class:"row justify-between items-center"},et={class:"col-auto"},tt={class:"col-auto"},at={class:"row"},lt={class:"row justify-center bg-grey-2 q-pa-md"},Z=12,ht={__name:"ShoppingPage",setup(e){const w=ie(),L=M([]),d=M(""),S=Le({電子產品:!1,服裝:!1,家居用品:!1,書籍:!1,玩具:!1,食品:!1,其他:!1}),m=i(()=>Object.keys(S).filter(c=>S[c])),u=i(()=>L.value.filter(c=>{const f=!d.value||c.name.toLowerCase().includes(d.value.toLowerCase()),r=m.value.length===0||m.value.includes(c.category);return f&&r}).sort((c,f)=>{const r=b[s.value];return r.key==="createdAt"||r.key==="updatedAt"?r.direction*(new Date(c[r.key])-new Date(f[r.key])):r.direction*(c[r.key]>f[r.key]?1:-1)})),s=M(0),b=[{text:"名稱",key:"name",direction:1},{text:"價格：低到高",key:"price",direction:1},{text:"價格：高到低",key:"price",direction:-1},{text:"最新商品",key:"createdAt",direction:-1},{text:"最舊商品",key:"createdAt",direction:1}],h=c=>{s.value=c,g.value=1},g=M(1),O=i(()=>Math.ceil(u.value.length/Z)),F=i(()=>{const c=(g.value-1)*Z,f=c+Z;return u.value.slice(c,f)});return(async()=>{try{const{data:c}=await De.get();L.value=c.products}catch(c){console.error("Error fetching products:",c),w.notify({type:"negative",message:"無法載入商品資料"})}})(),(c,f)=>(_(),E(Fe,{class:"flex q-ma-xl column"},{default:y(()=>[k("div",Je,[k("div",Ye,[v(oe,{modelValue:d.value,"onUpdate:modelValue":[f[0]||(f[0]=r=>d.value=r),f[1]||(f[1]=r=>g.value=1)],deleteable:"",label:"搜尋商品"},null,8,["modelValue"])]),k("div",Ze,[k("div",pe,[k("div",et,[(_(!0),H(G,null,W(S,(r,V)=>(_(),E(Be,{key:V,label:V,outline:"",color:"judy-4",selected:S[V],"onUpdate:selected":[A=>S[V]=A,A=>{g.value=1}]},null,8,["label","selected","onUpdate:selected"]))),128))]),k("div",tt,[v(X,{color:"judy-4",flat:"","icon-right":"arrow_drop_down",ripple:!1,class:"q-ml-sm"},{default:y(()=>[R(q(b[s.value].text)+" ",1),v(Me,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:y(()=>[v(Ie,{style:{"min-width":"100px"}},{default:y(()=>[(_(),H(G,null,W(b,(r,V)=>$e(v(qe,{key:V,clickable:"",onClick:A=>h(V)},{default:y(()=>[v(Qe,null,{default:y(()=>[R(q(r.text),1)]),_:2},1024)]),_:2},1032,["onClick"]),[[je]])),64))]),_:1})]),_:1})]),_:1})])])])]),k("div",at,[(_(!0),H(G,null,W(F.value,r=>(_(),H("div",{class:"col-12 col-sm-6 col-md-4 col-lg-3 q-pa-sm bg-grey-2",key:r.id},[v(Xe,{product:r},null,8,["product"])]))),128))]),k("div",lt,[v(Oe,{modelValue:g.value,"onUpdate:modelValue":f[2]||(f[2]=r=>g.value=r),max:O.value,color:"judy-4","boundary-links":""},null,8,["modelValue","max"])])]),_:1}))}};export{ht as default};
